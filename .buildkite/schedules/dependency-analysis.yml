# Nodes with values to reuse in the pipeline.
common_params:
  # Common plugin settings to use with the `plugins` key.
  - &ci_toolkit
      automattic/a8c-ci-toolkit#3.4.2

agents:
  queue: "android"

steps:
  - label: "dependency analysis"
    # The meta-data added is used by Apps Metrics Prometheus collector to find the build.
    command: |
      buildkite-agent meta-data set "scheduled-build" "dependency-analysis"
      echo "--- ðŸ“Š Analyzing"
      cp gradle.properties-example gradle.properties
      ./gradlew buildHealth
    plugins: [*ci_toolkit]
    artifact_paths:
      - "build/reports/dependency-analysis/build-health-report.*"
    notify:
      - slack: "#android-core-notifs"
        if: build.state == "failed"
